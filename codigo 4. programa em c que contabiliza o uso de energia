#include<stdio.h>
int max = 100;
int qtd = 0;


typedef struct eletrodomestico{
	char nome[50];
	double potencia;
	double tempoMedio;
}teletrodomestico;
//*******************************************************************//
int menu(){
	int op;
	printf("*** SYSTEM DE CONTROLE DE CONSUMO DE ENERGIA****\n");
	printf("1-Inserir novo eletrodomestico\n");
	printf("2-Mostrar todos os eletrodomesticos\n");
	printf("3-Salvar em arquivo txt\n");
	printf("4-Carregar arquivo txt\n");
	printf("5-Localizar por nome\n");
	printf("6-Eletrodomesticos com potencia, maior que um valor X\n");
	printf("7-Consumo diario e mensal\n");
	
	printf("0-Sair\n");
	scanf("%d",&op);
	return op;
}

void cadastrarEletrodomestico(teletrodomestico eletrodomestico[]){
	printf("***** Dados para o eletrodomestico %d *****\n",qtd+1);
	
	
	
	printf("Nome:\n");
	fflush(stdin);
	gets(eletrodomestico[qtd].nome);
	
	
	
	printf("Potencia (kW):\n");
	scanf("%lf",&eletrodomestico[qtd].potencia);
	
	
	
	printf("Tempo Medio de uso por dia (horas):\n");
	scanf("%lf",&eletrodomestico[qtd].tempoMedio);
	
	qtd++;
}


void mostraEletrodomesticos(teletrodomestico eletrodomestico[]){
	int k;
	
	for(k=0;k<qtd;k++){
		printf("\n***** Dados para o eletrodomestico %d *****\n",k+1);
		printf("Nome: %s\n",eletrodomestico[k].nome);
		printf("Potencia: %.2lf kW\n",eletrodomestico[k].potencia);
		printf("Tempo Medio: %.2lf horas\n",eletrodomestico[k].tempoMedio);
	}
}

void salvarDados(teletrodomestico eletrodomestico[]){
	int k;
	FILE *arq;
	arq = fopen("eletrodomesticos.txt","w");
	fprintf(arq,"%d\n",qtd);
	
	
	
	for(k=0;k<qtd;k++){
		fprintf(arq,"%s\n",eletrodomestico[k].nome);
		fprintf(arq,"%lf\n",eletrodomestico[k].potencia);
		fprintf(arq,"%lf\n",eletrodomestico[k].tempoMedio);
	}
	printf("Dados salvos com sucesso :)");
}

//*************************************************************************//
void carregaDados(teletrodomestico eletrodomestico[]){
	FILE *arq;
	int k;
	arq = fopen("eletrodomesticos.txt","r");
	if(arq==NULL){
		printf("Arquivo nao foi encontrado :(\n");
		return;
	}
	fscanf(arq,"%d",&qtd);
	for(k=0;k<qtd;k++){
		fscanf(arq,"%s",&eletrodomestico[k].nome);
		fscanf(arq,"%lf",&eletrodomestico[k].potencia);
		fscanf(arq,"%lf",&eletrodomestico[k].tempoMedio);
	}
	fclose(arq);
	printf("Dados obtidos com sucesso :)\n");
}
//**********************************************************************//


void buscarNome(teletrodomestico eletrodomestico[]){
	
	int k;
	char nome[50];
	printf("\nDigite o nome do eletrodomestico a ser buscado:\n");
	fflush(stdin);
	gets(nome);
	for(k=0;k<qtd;k++){
		if(strcmp(strupr(nome),strupr(eletrodomestico[k].nome)) == 0){
			printf("\n***** Dados para eletrodomestico %d *****\n",k+1);
			printf("Nome: %s\n",eletrodomestico[k].nome);
			printf("Potencia: %.2lf kW\n",eletrodomestico[k].potencia);
			printf("Tempo Medio: %.2lf horas\n",eletrodomestico[k].tempoMedio);	

		}
}
}
//************************************************************************************//

void buscarValorMaior(teletrodomestico eletrodomestico[]){
	int k;
	double x;
	printf("\nDigite o valor x:\n");
	scanf("%lf",&x);
		if(x < eletrodomestico[k].potencia){
			printf("\n***** Dados para eletrodomestico %d *****\n",k+1);
			printf("Nome: %s\n",eletrodomestico[k].nome);
			printf("Potencia: %.2lf kW\n",eletrodomestico[k].potencia);
			printf("Tempo Medio: %.2lf horas\n",eletrodomestico[k].tempoMedio);	
			
		}
		
		
	}


//****************************************************************//
void consumo(teletrodomestico eletrodomestico[]){
	int k;
	double valorkW,valor=0,total=0;
	printf("Digite o valor do kW/h:\n");
	scanf("%lf\n",&valorkW);
	
	for(k=0;k<qtd;k++){
		valor = eletrodomestico[k].potencia*eletrodomestico[k].tempoMedio;
		printf("Total de kW/h do %s (%.2lf Kw * %.2lf horas): %.2lf kW/h\n",eletrodomestico[k].nome,eletrodomestico[k].potencia,eletrodomestico[k].tempoMedio,valor);
		printf("Total em reais do %s (%.2lf kW/h * R$%.2lf): R$%.2lf\n\n",eletrodomestico[k].nome,valor,valorkW,valor*valorkW);
		total+=valor;
	}
	printf("\nTotal de gastos diariamente obtidos (%.2lf Kw/h * R$%.2lf): R$%.2lf",total,valorkW,total*valorkW);
	printf("\nTotal de gastos mensalmente obtidos (R$%.2lf * 30): R$%.2lf",total*valorkW,total*valorkW*30);
}
//*************************************************************************
int main(){
	int op=0;
	teletrodomestico eletrodomestico[max];
	
	do{
		op = menu();
		switch(op){
			case 1:
				cadastrarEletrodomestico(eletrodomestico);
				break;
			case 2:
				mostraEletrodomesticos(eletrodomestico);
				break;
				
			case 3:
				salvarDados(eletrodomestico);
				break;
			case 4:
				carregaDados(eletrodomestico);
				break;
			case 5:
				buscarNome(eletrodomestico);
				break;
			case 6:
				buscarValorMaior(eletrodomestico);
				break;
			case 7:
				consumo(eletrodomestico);
				break;	
			case 8:
			
				break;
		}
		
      	getch();
      	system("cls");
      	
	}while(op!=0);
	
	return 0;
}
